#import requests
import pandas as pd
#from bs4 import BeautifulSoup


#TODO: fix request query
#input should have + instead of " "
# def web_search(program):
#     url = 'https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=' + program
#     page = requests.get(url)
#     soup = BeautifulSoup(page.content, 'html.parser')
#     print(soup.prettify())

# query = {'cvekey.cgi?keyword': 'Apache 2.0'}
# r = requests.get('https://cve.mitre.org/cve/search_cve_list.html', data=query)
# print(r.text)


db = pd.read_csv('allitems.csv', encoding='ANSI', skiprows=2) #Reading csv file, Change skiprows if new csv file
#db_top = db.head(0) #Getting header titles
db.rename(columns={'Name': 'id', 'Description' : 'description'}, inplace=True) #Renaming column
db = db[['id', 'description']] #Selecting desired columns
#sub = db.loc[db['description'].str.contains('Apache')] #Getting rows with Apache in description

vuln_index_lst = []

def db_search(name):
    try:
        idx = db.index[db['description'].str.contains('adfjasdfj')]
        if len(idx) > 0:
            idx = idx[-1]
            vuln_index_lst.append(idx)
            cve = db.iloc[idx, db.columns.get_loc('id')]
        else:
            cve = 'not found'

    except IndexError:
        cve = 'No CVE found'
    return cve


def get_description(vuln_index_lst):
    details = []
    for i in vuln_index_lst:
        details.append(db.iloc[vuln_index_lst[i], db.columns.get_loc('description')])

    return details