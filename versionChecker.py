import requests
from bs4 import BeautifulSoup
import subprocess
import platform

def terminal_search(query):
    Data = subprocess.check_output([query])
    a = str(Data)
    lst = []

    try:
        for i in range(len(a)):
            tmp = a.split("\\r\\r\\n")[i].rstrip()
            lst.append(tmp)
    except IndexError as e:
        print("All Done")

    return lst

current_os = platform.system() #Determening current OS

if current_os == 'Windows':
    name = terminal_search('wmic', 'product', 'get', 'name')
    version = terminal_search('wmic', 'product', 'get', 'version')
elif current_os == 'Darwin':
    name = terminal_search('ps', 'axc', '|', 'sed', '"s/.*:..... /\"/"', '|', 'sed', 's/$/\"/')
else:
    name = terminal_search('ps -eo cmd')

# 'ps axc | sed "s/.*:..... /\"/" | sed s/$/\"/'

#TODO: fix request query
#input should have + instead of " "
def search(program):
    url = 'https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=' + program
    page = requests.get(url)
    soup = BeautifulSoup(page.content, 'html.parser')
    print(soup.prettify())

# query = {'cvekey.cgi?keyword': 'Apache 2.0'}
# r = requests.get('https://cve.mitre.org/cve/search_cve_list.html', data=query)
# print(r.text)

#TODO: implement application ignore list

# Notes:
# Experimented with Popen and os
# Experimented with commandline prompts
# os depreciated, move to subprocess

# Depreciated search function
#s1 = subprocess.Popen('wmic product get name', shell=True, stdout=subprocess.PIPE).communicate()[0]
#name = s1.strip().decode('ascii')
#print(name)